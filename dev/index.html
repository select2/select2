<!DOCTYPE html>
<html>

<head>
    <!-- polyfill for IE11 -->
    <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=es6"></script>
    <script src="../bridge/src/select25.tsx"></script>
    <script src="countries-data.js"></script>
    <link rel="stylesheet" href="../control/src/select25.scss" />
</head>

<body>
    <p>
        <label for="focus_grabber_1">Focus Grabber 1</label>
        <input type="text" value="focus grabber 1" autofocus id="focus_grabber_1"/>
    </p>
    <p>
        <section style="width:450px">
            <input type="hidden" id="countries1" />
        </section>
    </p>
    <p>
        <input type="button" id="destroy-multi" value="destroy" />
    </p>
    <p>
        <input type="text" value="focus grabber 2" />
    </p>
    <p>
        <section style="width:450px">
            <input type="hidden" id="countries2" />
        </section>
    </p>
    <p>
        <input type="text" value="focus grabber 3" />
    </p>
    <section>
        <input type="hidden" id="colors" data-s25-container-style="width:450px" />
    </section>

    <p>
        <label for="select1">Select Single</label>
        <select id="select1">
            <option>first</option>
            <option>second</option>
            <option selected>third</option>
            <option>fourth</option>
        </select>
    </p>
    <p>
        <label for="select2">Select Multiple</label>
        <select id="select2" multiple>
            <option>first</option>
            <option selected>second</option>
            <option selected>third</option>
            <option>fourth</option>
        </select>
    </p>
    <fieldset style="font-size: 18pt; color:#aaa">
        <legend>Boilerplate to force page to scroll</legend>
        <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna
            aliqua. Ornare massa eget egestas purus viverra. Enim sit amet venenatis urna cursus. Enim praesent elementum facilisis
            leo vel fringilla est ullamcorper. Viverra adipiscing at in tellus integer. Enim neque volutpat ac tincidunt. Dui
            faucibus in ornare quam viverra orci sagittis eu volutpat. Elementum integer enim neque volutpat ac tincidunt vitae
            semper quis. Leo a diam sollicitudin tempor id. Tincidunt eget nullam non nisi est sit. Risus viverra adipiscing at in.
            Dictumst vestibulum rhoncus est pellentesque elit ullamcorper dignissim cras. Risus at ultrices mi tempus imperdiet
            nulla malesuada pellentesque elit. Pretium nibh ipsum consequat nisl vel. Adipiscing elit duis tristique sollicitudin
            nibh. Sapien nec sagittis aliquam malesuada bibendum arcu vitae. Diam phasellus vestibulum lorem sed risus.
        </p>
        <p>
            Ac orci phasellus egestas tellus rutrum. Feugiat pretium nibh ipsum consequat nisl vel pretium lectus. Facilisis
            volutpat est velit egestas dui id ornare arcu odio. Vitae nunc sed velit dignissim sodales ut eu. Fermentum iaculis eu
            non diam. Leo in vitae turpis massa sed elementum. Amet massa vitae tortor condimentum lacinia quis. Tincidunt tortor
            aliquam nulla facilisi cras fermentum odio eu. Auctor elit sed vulputate mi sit. At elementum eu facilisis sed odio.
            Nulla aliquet enim tortor at auctor urna nunc id cursus. Enim ut sem viverra aliquet eget sit. Interdum velit euismod in
            pellentesque massa placerat duis ultricies. Tristique sollicitudin nibh sit amet commodo nulla.
        </p>
        <p>
            Dignissim diam quis enim lobortis scelerisque fermentum dui. Ultricies mi quis hendrerit dolor magna. Feugiat
            scelerisque varius morbi enim. Nec nam aliquam sem et tortor consequat id porta. Adipiscing bibendum est ultricies
            integer. Varius duis at consectetur lorem donec. Feugiat in ante metus dictum at tempor. A arcu cursus vitae congue
            mauris rhoncus. Eget dolor morbi non arcu risus quis varius quam. Ac turpis egestas integer eget aliquet nibh praesent
            tristique magna. Felis donec et odio pellentesque. Sed augue lacus viverra vitae congue eu consequat ac felis. Non enim
            praesent elementum facilisis leo vel. Gravida in fermentum et sollicitudin ac orci phasellus egestas. Etiam erat velit
            scelerisque in dictum non. Adipiscing elit duis tristique sollicitudin nibh sit.
        </p>
        <p>
            Adipiscing elit pellentesque habitant morbi tristique senectus. In hac habitasse platea dictumst quisque sagittis. Proin
            libero nunc consequat interdum varius sit amet mattis. Turpis cursus in hac habitasse platea dictumst quisque sagittis.
            Adipiscing tristique risus nec feugiat in fermentum posuere. Dignissim suspendisse in est ante in nibh mauris. Ut morbi
            tincidunt augue interdum velit euismod in pellentesque massa. Consequat id porta nibh venenatis. Augue lacus viverra
            vitae congue eu consequat ac. Leo duis ut diam quam nulla porttitor massa id. Pellentesque habitant morbi tristique
            senectus. Tortor at risus viverra adipiscing at in tellus. Tortor at auctor urna nunc.
        </p>
        <p>
            Eget aliquet nibh praesent tristique. Posuere urna nec tincidunt praesent semper feugiat. Nulla at volutpat diam ut
            venenatis. Ut pharetra sit amet aliquam id diam maecenas ultricies mi. Nunc congue nisi vitae suscipit tellus mauris a
            diam. Dignissim diam quis enim lobortis scelerisque. Eget mi proin sed libero enim sed. Elit ut aliquam purus sit amet
            luctus. Diam phasellus vestibulum lorem sed risus ultricies tristique. Sed ullamcorper morbi tincidunt ornare. Massa sed
            elementum tempus egestas sed sed risus pretium. Velit euismod in pellentesque massa. Sapien nec sagittis aliquam
            malesuada bibendum arcu vitae.
        </p>
    </fieldset>
</body>
<script>

    function countryToDataItem(c) {
        return {id:c.code, text:c.name};
    }

    var query = (function () {
        // local implementation of query that simulates network delay
        var countries = window.select2countries;

        var previousTimeout = undefined;
        var previousReject = undefined;

        return function (search, page, token) {
            if (previousReject != undefined) {
                previousReject(new Error('cancelled'));
                window.clearTimeout(previousTimeout);
            }
            var delay = 150;

            return new Promise(function (resolve, reject) {
                previousReject = reject;
                previousTimeout = window.setTimeout(function () {
                    var results = [];
                    var count = 0;
                    var limit = 10;
                    var offset = page * limit;
                    for (var i = 0; i < countries.length; i++) {
                        var country = countries[i];
                        if (country.name.toLowerCase().indexOf(search.toLowerCase()) >= 0) {
                            if (count >= offset) {
                                results.push(country);
                            }
                            count++;
                            if (count >= offset + limit) {
                                break;
                            }
                        }
                    }
                    previousTimeout = undefined;
                    previousReject = undefined;
                    resolve({
                        values: results.map(countryToDataItem),
                        more: results.length >= limit,
                        token: token
                    });
                }, delay);
            });
        };
    })();

    document.getElementById('countries1').addEventListener("change", function (event) {
        console.log("onchange fired on countries1", event);
    })

    window.select25.createMultiSelect(
        document.getElementById('countries1'), {
            valuesLabel: "Selected Countries",
            comboboxLabel: "Add Country",
            placeholder: "Add Country",
            minimumCharacters: 2,
            query: query,
            quiet: 100,
            values: [window.select2countries[0], window.select2countries[1], window.select2countries[1]].map(countryToDataItem),
        },
    );

    document.getElementById("destroy-multi").addEventListener("click", function () {
        window.select25.destroy(document.getElementById("countries1"));
    });

    window.select25.createSingleSelect(
        document.getElementById('countries2'), {
            allowClear: true,
            placeholder: "Select Country",
            minimumCharacters: 2,
            query: query,
            quiet: 100,

            value: countryToDataItem(window.select2countries[0])
        },
    );

    window.select25.createMultiSelect(
        document.getElementById("colors"), {
            minimumCharacters: 0,
            data: function (params) {
                var term = params.term ? params.term.trim() : "";
                var colors = ["Red", "Green", "Blue"];

                if (term.length > 0) {
                    var contains = colors.findIndex(c => c.toUpperCase() === term.toUpperCase());
                    if (contains < 0) {
                        colors.splice(0, 0, term);
                    } else {
                        // move matched element to the top so its selected
                        var color = colors.splice(contains, 1);
                        colors.splice(0, 0, color[0]);
                    }
                }

                return {
                    more: false,
                    values: colors.map(c => {
                        return {
                            id: c.toUpperCase(),
                            text: c
                        }
                    })
                };
            }
        }
    )
</script>

</html>